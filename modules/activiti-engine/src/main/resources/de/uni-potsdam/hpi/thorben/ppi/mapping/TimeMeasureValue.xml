<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="de.unipotsdam.hpi.thorben.ppi.measure.instance.entity.TimeMeasureValue">

  <!-- Write a measured value -->

  <insert id="insertTimeMeasur" parameterType="de.unipotsdam.hpi.thorben.ppi.measure.instance.entity.TimeMeasureValue">
    insert into ${prefix}PPI_BASE_TIME_MEASURE (ID_, MEASURE_ID_, PROC_INST_ID_, FROM_, TO_)
    values (
      #{id ,jdbcType=VARCHAR},
      #{measureId ,jdbcType=VARCHAR},
      #{processInstanceId ,jdbcType=VARCHAR},
      #{from ,jdbcType=VARCHAR},
      #{to ,jdbcType=VARCHAR}
    )
  </insert>
  
  <update id="updateTimeMeasur" parameterType="de.unipotsdam.hpi.thorben.ppi.measure.instance.entity.TimeMeasureValue">
    update ${prefix}PPI_BASE_TIME_MEASURE set
      ID_ = #{id ,jdbcType=VARCHAR},
      MEASURE_ID_ = #{measureId ,jdbcType=VARCHAR},
      PROC_INST_ID_ = #{processInstanceId ,jdbcType=VARCHAR},
      FROM_ = #{from ,jdbcType=VARCHAR},
      TO_ = #{to ,jdbcType=VARCHAR}
    where ID_ = #{id}
  </update>
  
  <resultMap id="timeMeasureResultMap" type="de.unipotsdam.hpi.thorben.ppi.measure.instance.entity.TimeMeasureValue">
    <id property="id" column="ID_" jdbcType="VARCHAR" />
    <result property="measureId" column="MEASURE_ID_" jdbcType="VARCHAR" />
    <result property="processInstanceId" column="PROC_INST_ID_" jdbcType="VARCHAR" />
    <result property="from" column="FROM_" jdbcType="VARCHAR" />
    <result property="to" column="TO_" jdbcType="VARCHAR" />
  </resultMap>
  

  <select id="selectTMVByMeasureIdAndProcessInstance" parameterType="map" resultMap="timeMeasureResultMap">
    select * from ${prefix}PPI_BASE_TIME_MEASURE 
    	where MEASURE_ID_ = #{measureId,jdbcType=VARCHAR} 
    	and PROC_INST_ID_ = #{processInstanceId,jdbcType=VARCHAR} 
  </select>
  
   <select id="selectTimeMeasureValueByQueryCriteria" parameterType="de.unipotsdam.hpi.thorben.ppi.measure.query.TimeMeasureValueQueryImpl" resultMap="timeMeasureResultMap">
  	${limitBefore}
    select *
    <include refid="selectTimeMeasureValueByQueryCriteriaSql" />
    <if test="orderBy != null">
      order by ${orderBy}
    </if>
    ${limitAfter}
  </select>
  
   <select id="selectTimeMeasureValueCountByQueryCriteria" parameterType="de.unipotsdam.hpi.thorben.ppi.measure.query.TimeMeasureValueQueryImpl" resultType="long">
    select count(U.ID_)
    <include refid="selectTimeMeasureValueByQueryCriteriaSql" />
  </select>
  
  <sql id="selectTimeMeasureValueByQueryCriteriaSql">
    from ${prefix}PPI_BASE_TIME_MEASURE 
    <where>
      <if test="id != null">
        ID_ = #{id}
      </if>
      <if test="measureId != null">
        and MEASURE_ID_ = #{measureId}
      </if>
      <if test="processInstanceId != null">
        and PROC_INST_ID_ like #{processInstanceId}
      </if>      
    </where>
  </sql>
</mapper>